<h1 style="text-align: center; font-size: 350%"> Twitter Penetration Test Report</h1>   
<h2 style="text-align: center">BI-EHA Semestral work</h2>


---

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br>

<h3 style="text-align: center;">Jan Koníř, Tadeáš Kouba</h3>
<h3 style="text-align: center;">FIT CTU, 2023</h3>

<!-- Page break -->
<div style="page-break-after: always;"></div>

<!-- ======================================================================================================================================================== -->
# Table of Contents

- [Table of Contents](#table-of-contents)
- [Introduction](#introduction)
  - [Team Info](#team-info)
  - [Project Overview](#project-overview)
  - [Scope Description](#scope-description)
  - [Pentesting Methodology](#pentesting-methodology)
  - [Scoring System](#scoring-system)
- [Executive Summary](#executive-summary)
- [List of Findings](#list-of-findings)
- [Pre-engagement](#pre-engagement)
  - [Threat Model](#threat-model)
  - [Intelligence-gathering Outcomes](#intelligence-gathering-outcomes)
- [Testing process](#testing-process)
  - [4.1 Information Gathering](#41-information-gathering)
  - [4.2 Configuration and Deployment Management Testing](#42-configuration-and-deployment-management-testing)
  - [4.3 Identity Management Testing](#43-identity-management-testing)
  - [4.4 Authentication Testing](#44-authentication-testing)
  - [4.5 Authorization Testing](#45-authorization-testing)
  - [4.6 Session Management Testing](#46-session-management-testing)
  - [4.7 Input Validation Testing](#47-input-validation-testing)
  - [4.8 Testing for Error Handling](#48-testing-for-error-handling)
  - [4.9 Testing for Weak Cryptography](#49-testing-for-weak-cryptography)
  - [4.10 Business Logic Testing](#410-business-logic-testing)
    - [4.10.1 Test Business Logic Data Validation](#4101-test-business-logic-data-validation)
    - [4.10.2 Test Ability to Forge Requests](#4102-test-ability-to-forge-requests)
    - [4.10.3 Test Integrity Checks](#4103-test-integrity-checks)
    - [4.10.4 Test for Process Timing](#4104-test-for-process-timing)
    - [4.10.5 Test Number of Times a Function Can Be Used Limits](#4105-test-number-of-times-a-function-can-be-used-limits)
    - [4.10.6 Testing for the Circumvention of Work Flows](#4106-testing-for-the-circumvention-of-work-flows)
    - [4.10.7 Test Defenses Against Application Misuse](#4107-test-defenses-against-application-misuse)
    - [4.10.8 Test Upload of Unexpected File Types](#4108-test-upload-of-unexpected-file-types)
    - [4.10.9 Test Upload of Malicious Files](#4109-test-upload-of-malicious-files)
  - [4.11 Client-side Testing](#411-client-side-testing)
- [Sources](#sources)


<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Introduction
## Team Info

- Jan Koníř
  - konirjan@fit.cvut.cz
  - Student of CTU, Faculty of Information Technology

<br>

- Tadeáš Kouba
  - koubatad@fit.cvut.cz
  - Student of CTU, Faculty of Information Technology

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Project Overview
This report is part of semestral work for subject Ethical hacking of the Information Security program on FIT, CTU.  
The focus is to assert skills gained during the semester as well as use them in real-world scenario. The website [twitter.com](https://twitter.com/) has been chosen for this purpouse as it offers a [bug bounty](https://hackerone.com/twitter?type=team) and is therefore eligible for ethical hackers to try and hack.  

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Scope Description
We will be focusing on the web application on domain twitter.com.  
While the bug bounty posted by twitter puts some vulnerabilities out scope for financial reward, we will still be trying to perform these attacks as to deepen our ethical hacking skills.

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Pentesting Methodology
<!-- https://owasp.org/www-project-web-security-testing-guide/stable/ -->
As a pentesting methodology we have chosen the [OWASP Web Application Security Testing](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/) guide - version 4.2, which is the latest stable version. To be more precise, we will be covering following topics:
  - Configuration and Deployment Management Testing
  - Identity Management Testing
  - Authentication Testing
  - Authorization Testing
  - Session Management Testing
  - Input Validation Testing
  - Testing for Error Handling
  - Testing for Weak Cryptography
  - Business Logic Testing
  - Client-side Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## Scoring System
We will be using the widely used [Common Vulnerability Scoring System (CVSS)](https://www.first.org/cvss/specification-document) standard for evaulating the threat levels of vulnerabilities found in this report. In particular we will use the CVSS 3.1 version. The standard defines multiple metrics (base, temporal, environmental), however we will use only the base metric since we are performing a one-time pentesting as external entity so the temporal and environmental metrics are not that important and available to us.  
We will be scoring each vulnerability on several factors such as access complexity, confidentiality impact, integrity impact and others, to calculate the final score. This will determine the final rating of that vulnerability as seen in the following table.  

<!-- CSS for scoring table-->
<style>
.scoring_table {
  width: 100%;
  border: 2px solid;
  border-collapse: collapse;
}

tr:nth-child(even) {
  background-color: #f2f2f2;
}

th {
  border-bottom: 2px solid;
  text-align: center;
}

td {
  border: 1px solid;
  text-align: center;
}
</style>

<!-- Scoring Table -->
<table class="scoring_table">
  <tr>
    <th>Rating</th>
    <th>CVSS Score</th>
  </tr>
  <tr>
    <td>Low</td>
    <td>0.1 - 3.9</td>
  </tr>
  <tr>
    <td>Medium</td>
    <td>4.0 - 6.9</td>
  </tr>
  <tr>
    <td>High</td>
    <td>7.0 - 8.9</td>
  </tr>
  <tr>
    <td>Critical</td>
    <td>9.0 - 10.0</td>
  </tr>
</table>

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Executive Summary
TBD

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# List of Findings
TBD

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Pre-engagement
## Threat Model
Twitter does not openly disclose how its backend communication works.  
Since twitter is a web application it is obviously exposed to the internet which naturally puts it in proximity of multitude of threats. On top of that it is definitely an attractive target for hackers, since it stores personal information of about 350 million people.  
Some vulnerable points might be the client-server-database communication for authentication or tweets being stored in database and showing to completely random users' feeds.

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Intelligence-gathering Outcomes
Firstly we ran port scan with **nmap**. We used the following command to find the open ports and possibly the version of service running on them:  
```nmap -sV twitter.com```  
![nmap -sV output](assets/preengagement/nmap_version.png)  

Full output can be seen in *outputs/nmap_version.txt*.     
We can see that there are two open tcp ports (80, 443).

We then ran **nmap** with intention to determine the OS running, version and traceroute with:  
```nmap -A twitter.com```  
![nmap -A output 1](assets/preengagement/nmap_output2.png)  

![nmap -A output 2](assets/preengagement/nmap_output1.png)  
Full output can be seen in *outputs/nmap_A.txt*.   
Here it is specified that on port 80 there is http running. Also all requests sent are returned with HTTP 400 so service as well as OS could not be recognized.

Then we ran **dnsenum** to try and gather some infromation about the domain:  
```dnsenum --enum twitter.com```  
![ dnsenum output ](assets/preengagement/dnsenum_output.png)  
Full output can be seen in *outputs/dnsenum.txt*.     
Which listed us a lot of subdomains and IP addresses of twitter.


As stated before the twitter developers don't share much information about twitter.
However through developer [blog](https://blog.twitter.com/engineering/en_us/topics/) they sometimes discuss what actually happens on twitter's backend. Through that we were able to find out that twitter used to run on MySQL database, but has switched to distributed database NoSQL system called Manhattan, that is custom developed for twitter. Manhattan itself utilizes multiple open-source technologies like Apache Cassandra or Hadoop. This information might prove useful for performing some SQL Injection attacks. 

As for the front-end part of Twitter it mostly consists of HTML, CSS and Javascript, particularly React.js. Of those, React.js is obviously the one to be concentrated on when pentesting. Some of its most common vulnerabilities are Cross-site scripting, SQL injection, Cross-site request forgery, Vulnerability in packages and dependencies, Broken authentication, Zip slip or XML external entities.

Last but not least we tried so called Google Hacking/Dorking but it didn't disclose any important information.

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Testing process

## 4.1 Information Gathering

This topic is covered in the [Pre-engagement section](#pre-engagement).

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.2 Configuration and Deployment Management Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.3 Identity Management Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.4 Authentication Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.5 Authorization Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.6 Session Management Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.7 Input Validation Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.8 Testing for Error Handling

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.9 Testing for Weak Cryptography

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.10 Business Logic Testing

### 4.10.1 Test Business Logic Data Validation

As for the GUI, the only input where validation is needed is the create account form. Other inputs such as tweet, searched value etc. may be pretty much anything. GUI checks the email meaning if it has form of an email address ({name}@{domain}). It doesn't check if the email actually exists, however the next step of account creation is entering the verification code which is sent to the email entered before. That implies that we cannot use neither non-existing email nor an email address that we don't have access to.  
Date of birth is checked as well, account creation failes when date from future entered.

<img src="assets/business_logic_testing/create_account_invalid_email.png" alt="invalid email adress" width=49%>
<img src="assets/business_logic_testing/create_account_non_existing_email.png" alt="non-existing email" width=49%><br>

<img src="assets/business_logic_testing/create_account_date_from_future.png" alt="date from future" width=69%>
<img src="assets/business_logic_testing/create_account_date_from_future_failed.png" alt="date from future failed" width=30%><br>

When performed single HTTP requests as such containing invalid data, to all of them we got response more or less describing why the request was invalid. Except when the JSON object contained two email elements, in that case server responded with 500 Internal Server Error meaning this edge case is not correctly handled (likely by the JSON parser).

<img src="assets/business_logic_testing/request_create_account_blank_email.png" alt="blank email">
<img src="assets/business_logic_testing/request_create_account_invalid_email.png" alt="invalid email">
<img src="assets/business_logic_testing/request_create_account_verification_different_json_parameter.png" alt="different json parameter">
<img src="assets/business_logic_testing/request_create_account_verification_invalid_email.png" alt="invalid email">
<img src="assets/business_logic_testing/request_create_account_verification_no_email.png" alt="no email">
<img src="assets/business_logic_testing/request_create_account_verification_two_emails.png" alt="two emails">


### 4.10.2 Test Ability to Forge Requests

When reviewed the common HTTP traffic, no guessable values nor hidden features were found. Data consist of user entered content and apparently randomly generated tokens and ids.


### 4.10.3 Test Integrity Checks

We didn't find neither hidden fields nor places to insert information into areas that are non-editable.


### 4.10.4 Test for Process Timing

Entering both correct and incorect username and password took the same time to process. We didn't find any other scenario in which process timing might be taken advantage of.


### 4.10.5 Test Number of Times a Function Can Be Used Limits

The application has several technical limits as follows:
<!-- CSS for limits table-->
<style>
.limits_table {
  width: 100%;
  border: 2px solid;
  border-collapse: collapse;
}

tr:nth-child(even) {
  background-color: #f2f2f2;
}

th {
  border-bottom: 2px solid;
  text-align: center;
}

td {
  border: 1px solid;
  text-align: center;
}
</style>
<!-- Limits table-->
<table class="limits_table">
    <tr>
        <th>Functionality</th>
        <th>Limit</th>
    </tr>
    <tr>
        <td>Direct Messages</td>
        <td>500 messages sent per day</td>
    </tr>
    <tr>
        <td>Tweets</td>
        <td>2400 per day</td>
    </tr>
    <tr>
        <td>Changes to account email</td>
        <td>4 per hour</td>
    </tr>
    <tr>
        <td>Following (daily)</td>
        <td>400 per day</td>
    </tr>
    <tr>
        <td>Following (account-based)</td>
        <td>5000 per account</td>
    </tr>
</table>

We haven't been able to test any of them because the limits are too high to perform manually, sending repeated requests through BurpSuite or curl didn't work and API for those tasks is a paid functionality. In case of Changes to account email it would be possible to perform manual test except the fact that probably due to our penetration testing Twitter wouldn't allow us to do so, even when we created a fresh account with no suspicious history.

<img src="assets/business_logic_testing/change_email_failed.png" alt="change email failed" width=50%><br>


### 4.10.6 Testing for the Circumvention of Work Flows

The only multistep activity is the account creation, which cannot be bypassed due to email verification as one of the steps. No other multistep activity was found.


### 4.10.7 Test Defenses Against Application Misuse

### 4.10.8 Test Upload of Unexpected File Types

### 4.10.9 Test Upload of Malicious Files

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.11 Client-side Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->


# Sources

- https://blog.twitter.com/engineering/en_us/topics/infrastructure/2017/the-infrastructure-behind-twitter-scale

- https://www.first.org/cvss

- https://blog.twitter.com/engineering/en_us/topics/

- http://www.pentest-standard.org

- https://www.thirdrocktechkno.com/blog/react-security-vulnerabilities/

- https://help.twitter.com/en/rules-and-policies/twitter-limits
