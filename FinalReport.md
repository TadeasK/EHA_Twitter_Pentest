<!-- Style to center all images -->
<style>
  img {
    display: block;
    margin-left: auto;
    margin-right: auto;
  }
</style>
<h1 style="text-align: center; font-size: 350%"> Twitter Penetration Test Report</h1>   
<h2 style="text-align: center">BI-EHA Semestral work</h2>


---

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br>

<h3 style="text-align: center;">Jan Koníř, Tadeáš Kouba</h3>
<h3 style="text-align: center;">FIT CTU, 2023</h3>

<!-- Page break -->
<div style="page-break-after: always;"></div>

<!-- ======================================================================================================================================================== -->

# Table of Contents

- [Table of Contents](#table-of-contents)
- [Introduction](#introduction)
  - [Team Info](#team-info)
  - [Project Overview](#project-overview)
  - [Scope Description](#scope-description)
  - [Pentesting Methodology](#pentesting-methodology)
  - [Scoring System](#scoring-system)
- [Executive Summary](#executive-summary)
- [List of Findings](#list-of-findings)
- [Pre-engagement](#pre-engagement)
  - [Threat Model](#threat-model)
  - [Intelligence-gathering Outcomes](#intelligence-gathering-outcomes)
- [Testing process](#testing-process)
  - [4.1 Information Gathering](#41-information-gathering)
  - [4.2 Configuration and Deployment Management Testing](#42-configuration-and-deployment-management-testing)
    - [4.2.1 Test Network Infrastructure Configuration](#421-test-network-infrastructure-configuration)
    - [4.2.2 Test Application Platform Configuration](#422-test-application-platform-configuration)
    - [4.2.3 Test File Extensions Handling for Sensitive Information](#423-test-file-extensions-handling-for-sensitive-information)
    - [4.2.4 Review Old Backup and Unreferenced Files for Sensitive Information](#424-review-old-backup-and-unreferenced-files-for-sensitive-information)
    - [4.2.5 Enumerate Infrastructure and Application Admin Interfaces](#425-enumerate-infrastructure-and-application-admin-interfaces)
    - [4.2.6 Test HTTP Methods](#426-test-http-methods)
    - [4.2.7 Test HTTP Strict Transport Security](#427-test-http-strict-transport-security)
    - [4.2.8 Test RIA Cross Domain Policy](#428-test-ria-cross-domain-policy)
    - [4.2.9 Test File Permission](#429-test-file-permission)
    - [4.2.10 Test for Subdomain Takeover](#4210-test-for-subdomain-takeover)
    - [4.2.11 Test Cloud Storage](#4211-test-cloud-storage)
  - [4.3 Identity Management Testing](#43-identity-management-testing)
    - [4.3.1 Test Role Definitions](#431-test-role-definitions)
    - [4.3.2 Test User Registration Process](#432-test-user-registration-process)
    - [4.3.4 Testing for Account Enumeration and Guessable User Account](#434-testing-for-account-enumeration-and-guessable-user-account)
    - [4.3.5 Testing for Weak or Unenforced Username Policy](#435-testing-for-weak-or-unenforced-username-policy)
  - [4.4 Authentication Testing](#44-authentication-testing)
    - [4.4.1 Testing for Credentials Transported over an Encrypted Channel](#441-testing-for-credentials-transported-over-an-encrypted-channel)
    - [4.4.2 Testing for Default Credentials](#442-testing-for-default-credentials)
    - [4.4.3 Testing for Weak Lock Out Mechanism](#443-testing-for-weak-lock-out-mechanism)
    - [4.4.4 Testing for Bypassing Authentication Schema](#444-testing-for-bypassing-authentication-schema)
    - [4.4.5 Testing for Vulnerable Remember Password](#445-testing-for-vulnerable-remember-password)
    - [4.4.6 Testing for Browser Cache Weaknesses](#446-testing-for-browser-cache-weaknesses)
    - [4.4.7 Testing for Weak Password Policy](#447-testing-for-weak-password-policy)
    - [4.4.8 Testing for Weak Security Question Answer](#448-testing-for-weak-security-question-answer)
    - [4.4.9 Testing for Weak Password Change or Reset Functionalities](#449-testing-for-weak-password-change-or-reset-functionalities)
    - [4.4.10 Testing for Weaker Authentication in Alternative Channel](#4410-testing-for-weaker-authentication-in-alternative-channel)
  - [4.5 Authorization Testing](#45-authorization-testing)
    - [4.5.1 Testing Directory Traversal File Include](#451-testing-directory-traversal-file-include)
    - [4.5.2 Testing for Bypassing Authorization Schema](#452-testing-for-bypassing-authorization-schema)
    - [4.5.3 Testing for Privilege Escalation](#453-testing-for-privilege-escalation)
    - [4.5.4 Testing for Insecure Direct Object References](#454-testing-for-insecure-direct-object-references)
  - [4.6 Session Management Testing](#46-session-management-testing)
    - [4.6.1 Testing for Session Management Schema](#461-testing-for-session-management-schema)
    - [4.6.2 Testing for Cookies Attributes](#462-testing-for-cookies-attributes)
    - [4.6.3 Testing for Session Fixation](#463-testing-for-session-fixation)
    - [4.6.4 Testing for Exposed Session Variables](#464-testing-for-exposed-session-variables)
    - [4.6.5 Testing for Cross Site Request Forgery](#465-testing-for-cross-site-request-forgery)
    - [4.6.6 Testing for Logout Functionality](#466-testing-for-logout-functionality)
    - [4.6.7 Testing Session Timeout](#467-testing-session-timeout)
    - [4.6.8 Testing for Session Puzzling](#468-testing-for-session-puzzling)
    - [4.6.9 Testing for Session Hijacking](#469-testing-for-session-hijacking)
  - [4.7 Input Validation Testing](#47-input-validation-testing)
    - [4.7.1 Testing for Reflected Cross Site Scripting](#471-testing-for-reflected-cross-site-scripting)
    - [4.7.2 Testing for Stored Cross Site Scripting](#472-testing-for-stored-cross-site-scripting)
    - [4.7.3 Testing for HTTP Verb Tampering](#473-testing-for-http-verb-tampering)
    - [4.7.4 Testing for HTTP Parametr Pollution](#474-testing-for-http-parametr-pollution)
    - [4.7.5 Testing for SQL Injection](#475-testing-for-sql-injection)
    - [4.7.6 Testing for LDAP Injection](#476-testing-for-ldap-injection)
    - [4.7.7 Testing for XML Injection](#477-testing-for-xml-injection)
    - [4.7.8 Testing for SSI Injection](#478-testing-for-ssi-injection)
    - [4.7.9 Testing for XPath Injection](#479-testing-for-xpath-injection)
    - [4.7.10 Testing for IMAP SMTP Injection](#4710-testing-for-imap-smtp-injection)
    - [4.7.11 Testing for Code Injection](#4711-testing-for-code-injection)
      - [4.7.11.1 Testing for Local File Inclusion](#47111-testing-for-local-file-inclusion)
      - [4.7.11.2 Testing for Remote File Inclusion](#47112-testing-for-remote-file-inclusion)
    - [4.7.12 Testing for Command Injection](#4712-testing-for-command-injection)
    - [4.7.13 Testing for Format String Injection](#4713-testing-for-format-string-injection)
    - [4.7.14 Testing for Incubated Vulnerability](#4714-testing-for-incubated-vulnerability)
    - [4.7.15 Testing for HTTP Splitting Smuggling](#4715-testing-for-http-splitting-smuggling)
    - [4.7.16 Testing for HTTP Incoming Requests](#4716-testing-for-http-incoming-requests)
    - [4.7.17 Testing for Host Header Injection](#4717-testing-for-host-header-injection)
    - [4.7.18 Testing for Server-side Template Injection](#4718-testing-for-server-side-template-injection)
    - [4.7.19 Testing for Server-side Request Forgery](#4719-testing-for-server-side-request-forgery)
  - [4.8 Testing for Error Handling](#48-testing-for-error-handling)
    - [4.8.1 Testing for Improper Error Handling](#481-testing-for-improper-error-handling)
  - [4.9 Testing for Weak Cryptography](#49-testing-for-weak-cryptography)
    - [4.9.1 Testing for Weak Transport Layer Security](#491-testing-for-weak-transport-layer-security)
    - [4.9.2 Testing for Padding Oracle](#492-testing-for-padding-oracle)
    - [4.9.3 Testing for Sensitive Information Sent via Unencrypted Channels](#493-testing-for-sensitive-information-sent-via-unencrypted-channels)
    - [4.9.4 Testing for Weak Encryption](#494-testing-for-weak-encryption)
  - [4.10 Business Logic Testing](#410-business-logic-testing)
    - [4.10.1 Test Business Logic Data Validation](#4101-test-business-logic-data-validation)
    - [4.10.2 Test Ability to Forge Requests](#4102-test-ability-to-forge-requests)
    - [4.10.3 Test Integrity Checks](#4103-test-integrity-checks)
    - [4.10.4 Test for Process Timing](#4104-test-for-process-timing)
    - [4.10.5 Test Number of Times a Function Can Be Used Limits](#4105-test-number-of-times-a-function-can-be-used-limits)
    - [4.10.6 Testing for the Circumvention of Work Flows](#4106-testing-for-the-circumvention-of-work-flows)
    - [4.10.7 Test Defenses Against Application Misuse](#4107-test-defenses-against-application-misuse)
    - [4.10.8 Test Upload of Unexpected File Types](#4108-test-upload-of-unexpected-file-types)
    - [4.10.9 Test Upload of Malicious Files](#4109-test-upload-of-malicious-files)
  - [4.11 Client-side Testing](#411-client-side-testing)
    - [4.11.1 Testing for DOM-Based Cross Site Scripting](#4111-testing-for-dom-based-cross-site-scripting)
    - [4.11.2 Testing for JavaScript Execution](#4112-testing-for-javascript-execution)
    - [4.11.3 Testing for HTML Injection](#4113-testing-for-html-injection)
    - [4.11.4 Testing for Client-side URL Redirect](#4114-testing-for-client-side-url-redirect)
    - [4.11.5 Testing for CSS Injection](#4115-testing-for-css-injection)
    - [4.11.6 Testing for Client-side Resource Manipulation](#4116-testing-for-client-side-resource-manipulation)
    - [4.11.7 Testing Cross Origin Resource Sharing](#4117-testing-cross-origin-resource-sharing)
    - [4.11.8 Testing for Cross Site Flashing](#4118-testing-for-cross-site-flashing)
    - [4.11.9 Testing for Clickjacking](#4119-testing-for-clickjacking)
    - [4.11.10 Testing WebSockets](#41110-testing-websockets)
    - [4.11.11 Testing Web Messaging](#41111-testing-web-messaging)
    - [4.11.12 Testing Browser Storage](#41112-testing-browser-storage)
    - [4.11.13 Testing for Cross Site Script Inclusion](#41113-testing-for-cross-site-script-inclusion)
- [Sources](#sources)


<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Introduction
## Team Info

- Jan Koníř
  - konirjan@fit.cvut.cz
  - Student of CTU, Faculty of Information Technology
  - Responsible for
    - [4.2 Configuration and Deployment Management Testing](#42-configuration-and-deployment-management-testing)
    - [4.6 Session Management Testing](#46-session-management-testing)
    - [4.7 Input Validation Testing](#47-input-validation-testing)
      - [4.7.10 Testing for IMAP SMTP Injection](#4710-testing-for-imap-smtp-injection)
      - [4.7.11 Testing for Code Injection](#4711-testing-for-code-injection)
        - [4.7.11.1 Testing for Local File Inclusion](#47111-testing-for-local-file-inclusion)
        - [4.7.11.2 Testing for Remote File Inclusion](#47112-testing-for-remote-file-inclusion)
      - [4.7.12 Testing for Command Injection](#4712-testing-for-command-injection)
      - [4.7.13 Testing for Format String Injection](#4713-testing-for-format-string-injection)
      - [4.7.14 Testing for Incubated Vulnerability](#4714-testing-for-incubated-vulnerability)
      - [4.7.15 Testing for HTTP Splitting Smuggling](#4715-testing-for-http-splitting-smuggling)
      - [4.7.16 Testing for HTTP Incoming Requests](#4716-testing-for-http-incoming-requests)
      - [4.7.17 Testing for Host Header Injection](#4717-testing-for-host-header-injection)
      - [4.7.18 Testing for Server-side Template Injection](#4718-testing-for-server-side-template-injection)
      - [4.7.19 Testing for Server-side Request Forgery](#4719-testing-for-server-side-request-forgery)
    - [4.9 Testing for Weak Cryptography](#49-testing-for-weak-cryptography)
    - [4.10 Business Logic Testing](#410-business-logic-testing)

- Tadeáš Kouba
  - koubatad@fit.cvut.cz
  - Student of CTU, Faculty of Information Technology
  - Responsible for
    - [4.3 Identity Management Testing](#43-identity-management-testing)
    - [4.4 Authentication Testing](#44-authentication-testing)
    - [4.5 Authorization Testing](#45-authorization-testing)
    - [4.7 Input Validation Testing](#47-input-validation-testing)
      - [4.7.1 Testing for Reflected Cross Site Scripting](#471-testing-for-reflected-cross-site-scripting)
      - [4.7.2 Testing for Stored Cross Site Scripting](#472-testing-for-stored-cross-site-scripting)
      - [4.7.3 Testing for HTTP Verb Tampering](#473-testing-for-http-verb-tampering)
      - [4.7.4 Testing for HTTP Parametr Pollution](#474-testing-for-http-parametr-pollution)
      - [4.7.5 Testing for SQL Injection](#475-testing-for-sql-injection)
      - [4.7.6 Testing for LDAP Injection](#476-testing-for-ldap-injection)
      - [4.7.7 Testing for XML Injection](#477-testing-for-xml-injection)
      - [4.7.8 Testing for SSI Injection](#478-testing-for-ssi-injection)
      - [4.7.9 Testing for XPath Injection](#479-testing-for-xpath-injection)
    - [4.8 Testing for Error Handling](#48-testing-for-error-handling)
    - [4.11 Client-side Testing](#411-client-side-testing)

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Project Overview
This report is part of semestral work for subject Ethical hacking of the Information Security program on FIT, CTU.  
The focus is to assert skills gained during the semester as well as use them in real-world scenario. The website [twitter.com](https://twitter.com/) has been chosen for this purpouse as it offers a [bug bounty](https://hackerone.com/twitter?type=team) and is therefore eligible for ethical hackers to try and hack.  

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Scope Description
We will be focusing on the web application on domain twitter.com.  
While the bug bounty posted by twitter puts some vulnerabilities out scope for financial reward, we will still be trying to perform these attacks as to deepen our ethical hacking skills.

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Pentesting Methodology
<!-- https://owasp.org/www-project-web-security-testing-guide/stable/ -->
As a pentesting methodology we have chosen the [OWASP Web Application Security Testing guide - version 4.2](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/), which is the latest stable version. To be more precise, we will be covering following topics:
  - Configuration and Deployment Management Testing
  - Identity Management Testing
  - Authentication Testing
  - Authorization Testing
  - Session Management Testing
  - Input Validation Testing
  - Testing for Error Handling
  - Testing for Weak Cryptography
  - Business Logic Testing
  - Client-side Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## Scoring System
We will be using the widely used [Common Vulnerability Scoring System (CVSS)](https://www.first.org/cvss/specification-document) standard for evaulating the threat levels of vulnerabilities found in this report. In particular we will use the CVSS 3.1 version. The standard defines multiple metrics (base, temporal, environmental), however we will use only the base metric since we are performing a one-time pentesting as external entity so the temporal and environmental metrics are not that important and available to us.  
We will be scoring each vulnerability on several factors such as access complexity, confidentiality impact, integrity impact and others, to calculate the final score. This will determine the final rating of that vulnerability as seen in the following table.  

<!-- CSS for scoring table-->
<style>
.scoring_table {
  width: 100%;
  border: 2px solid;
  border-collapse: collapse;
}

tr:nth-child(even) {
  background-color: #f2f2f2;
}

th {
  border-bottom: 2px solid;
  text-align: center;
}

td {
  border: 1px solid;
  text-align: center;
}
</style>

<!-- Scoring Table -->
<table class="scoring_table">
  <tr>
    <th>Rating</th>
    <th>CVSS Score</th>
  </tr>
  <tr>
    <td>Low</td>
    <td>0.1 - 3.9</td>
  </tr>
  <tr>
    <td>Medium</td>
    <td>4.0 - 6.9</td>
  </tr>
  <tr>
    <td>High</td>
    <td>7.0 - 8.9</td>
  </tr>
  <tr>
    <td>Critical</td>
    <td>9.0 - 10.0</td>
  </tr>
</table>

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Executive Summary
TBD

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# List of Findings
TBD

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Pre-engagement
## Threat Model
Twitter does not openly disclose how its backend communication works.  
Since twitter is a web application it is obviously exposed to the internet which naturally puts it in proximity of multitude of threats. On top of that it is definitely an attractive target for hackers, since it stores personal information of about 350 million people.  
Some vulnerable points might be the client-server-database communication for authentication or tweets being stored in database and showing to completely random users' feeds.

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Intelligence-gathering Outcomes
Firstly we ran port scan with **nmap**. We used the following command to find the open ports and possibly the version of service running on them:  
```nmap -sV twitter.com```  
![nmap -sV output](assets/preengagement/nmap_version.png)  

Full output can be seen in *outputs/nmap_version.txt*.     
We can see that there are two open tcp ports (80, 443).

We then ran **nmap** with intention to determine the OS running, version and traceroute with:  
```nmap -A twitter.com```  
![nmap -A output 1](assets/preengagement/nmap_output2.png)  

![nmap -A output 2](assets/preengagement/nmap_output1.png)  
Full output can be seen in *outputs/nmap_A.txt*.   
Here it is specified that on port 80 there is http running. Also all requests sent are returned with HTTP 400 so service as well as OS could not be recognized.

Then we ran **dnsenum** to try and gather some infromation about the domain:  
```dnsenum --enum twitter.com```  
![ dnsenum output ](assets/preengagement/dnsenum_output.png)  
Full output can be seen in *outputs/dnsenum.txt*.     
Which listed us a lot of subdomains and IP addresses of twitter.


As stated before the twitter developers don't share much information about twitter.
However through developer [blog](https://blog.twitter.com/engineering/en_us/topics/) they sometimes discuss what actually happens on twitter's backend. Through that we were able to find out that twitter used to run on MySQL database, but has switched to distributed database NoSQL system called Manhattan, that is custom developed for twitter. Manhattan itself utilizes multiple open-source technologies like Apache Cassandra or Hadoop. This information might prove useful for performing some SQL Injection attacks. 

As for the front-end part of Twitter it mostly consists of HTML, CSS and Javascript, particularly React.js. Of those, React.js is obviously the one to be concentrated on when pentesting. Some of its most common vulnerabilities are Cross-site scripting, SQL injection, Cross-site request forgery, Vulnerability in packages and dependencies, Broken authentication, Zip slip or XML external entities.

Last but not least we tried so called Google Hacking/Dorking but it didn't disclose any important information.

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Testing process

## 4.1 Information Gathering

<<<<<<< Updated upstream
This topic is covered in the [Pre-engagement section](#pre-engagement).
=======
### 4.1.1 Conduct Search Engine Discovery Reconnaissance for Information Leakage

This section is covered in [Pre-engagement](#pre-engagement).

### 4.1.2 Fingerprint Web Server

This section is covered in [Pre-engagement](#pre-engagement).

### 4.1.3 Review Webserver Metafiles for Information Leakage

Robots.txt exists on the page. After reviewing disallowed paths, it doesn't seem to be considered as a mechanism to enforce restrictions.

<img src="assets/information_gathering/robots_txt.png" alt="robots.txt"><br>

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

Sitemaps weren't found.  

Security.txt

<img src="assets/information_gathering/security_txt.png" alt="security.txt"><br>

Humans.txt wasn't found.

### 4.1.4 Enumerate Applications on Webserver

This section is covered in [Pre-engagement](#pre-engagement).  


### 4.1.5 Review Webpage Content for Information Leakage

When reviewing the client side source code, no useful comments, metadata or other useful information were found.


### 4.1.6 Identify Application Entry Points

Despite reviewing many different requests and responses during the testing process, we simply didn't have the manpower to execute full review of all methods and parameters as there are hundreds or possibly thousands of them.

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

### 4.1.7 Map Execution Paths Through Application

<img src="assets/information_gathering/known_paths.png" alt="known paths"><br>

### 4.1.8 Fingerprint Web Application Framework

This section is covered in [Pre-engagement](#pre-engagement). 

### 4.1.9 Fingerprint Web Application

This section has been merged into [4.1.8 Fingerprint Web Application Framework](#418-fingerprint-web-application-framework)

### 4.1.10 Map Application Architecture

This section is covered in [Pre-engagement](#pre-engagement).
>>>>>>> Stashed changes

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.2 Configuration and Deployment Management Testing

### 4.2.1 Test Network Infrastructure Configuration

As we don't have access to neither used systems nor any configuration files, this test cannot be performed.


### 4.2.2 Test Application Platform Configuration

We ran `dirb` to scan for sample and known files and directories.  
<img src="assets/configuration_and_deployment_management_testing/dirb_known_files.png" alt=" Dirb known files output"><br>
All of the requests were valid endpoints, redirections, account names or the Twitter's custom "Page was not found" page.


### 4.2.3 Test File Extensions Handling for Sensitive Information

For this test we ran `dirb` again, but this time with file extensions wordlist. It didn't disclose any new files or pages.  
<img src="assets/configuration_and_deployment_management_testing/dirb_extensions.png" alt="Dirb file extensions output"><br>


### 4.2.4 Review Old Backup and Unreferenced Files for Sensitive Information

We haven't found neither endpoints nor functions suitable for inference from the naming scheme.

When reviewing the front-end source code, no useful comments were found.

Blind guessing was performed in the previous sections with no success.


### 4.2.5 Enumerate Infrastructure and Application Admin Interfaces

We weren't able to reveal any admin interface.


### 4.2.6 Test HTTP Methods

Running `nmap`  with http-methods script disclosed that only reasonable HTTP methods are allowed.  
<img src="assets/configuration_and_deployment_management_testing/nmap_http_methods.png"><br>


### 4.2.7 Test HTTP Strict Transport Security

<!-- maybe a vulnerability?? -->
HTTP Strict Transport Security header is included in the response. However it lacks the includeSubDomains directive and since there are public subdomains such as [blog.twitter.com](blog.twitter.com) or [about.twitter.com](about.twitter.com) and none of them probably require usage of unsecured http, the includeSubDomains directive should be included as well.  
<img src="assets/configuration_and_deployment_management_testing/curl_hsts.png"><br>


### 4.2.8 Test RIA Cross Domain Policy

Neither crossdomain.xml nor clientaccesspolicy.xml are accessible.

 
### 4.2.9 Test File Permission

We don't have access to any web server, so we cannot inspect the local file permissions. No online directories were found.


### 4.2.10 Test for Subdomain Takeover

`dnsrecon` found no records and therefore no records suitable for takeover.  
<img src="assets/configuration_and_deployment_management_testing/dnsrecon.png"><br>

### 4.2.11 Test Cloud Storage

abs.twimg.com seems to be a cloud service but it only provides public content such as tweets, additional javascript code, emoji and CSS for the client web application so the authorization for reading is not required. Updating the file was not successful.  
<img src="assets/configuration_and_deployment_management_testing/curl_cloud_put.png"><br>


<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.3 Identity Management Testing
### 4.3.1 Test Role Definitions
Since the application is being tested as a black-box from a normal user standpoint we don't have information about available roles. Even after looking throught HTTP communication any specific roles
could not be identified. Therefore we are not able to test roles layout or permissions.  

### 4.3.2 Test User Registration Process
User can register using several different options (with Google/Apple account or native) we will test native registration process as the other two are using different applications and are out of scope.  
<img src="assets/identity_management/register_options.png" alt="Regsitration options" width="50%" height="50%">  

The requirments for registration are name, email and date of birth of user. Out of these options only email can be verified. Name can be anything and does not need to be unique, date of birth can be set to anything as it is not verified either.  
<img src="assets/identity_management/register_user_info.png" alt= "User data" width="50%" height="50%">  

In next step user is asked for different permissions which may be granted but are not required.  
<img src="assets/identity_management/register_permissions.png" alt=" Registration permissions " width="50%" height="50%">

In next step user information is confirmed (Notice that date of birth really does not matter as in the example the user's age is 5 years and email is checked in prior stages).  
<img src="assets/identity_management/register_confirmation.png" alt=" Confirm Registration " width="50%" height="50%">  

Next user is prompted to input the code sent to him via email (6 digits). Last step is the creation of password which is described in detail in [authentication testing](#44-authentication-testing)  
In summary anyone with access to an email can create twitter account. Registrations are granted automatically after confirmig email validity. As long as one has access to a valid email
he can register as many times as he can (for purposes of testing we created 5+ accounts with throwaway emails). Users can only register with basic user permissions and the only proof of
identity is email verification.  

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

### 4.3.4 Testing for Account Enumeration and Guessable User Account
It is quite easy to enumerate emails of accounts either when registrating (already used emails inform the user that email is used) or when trying to log in - when using valid email user is redirected to
input his password and when invalid email (not used in registration of any account yet) the following message is shown: *`Sorry, we could not find your account.`* also a HTTP response **400 Bad Request** is sent. 
When we have a valid email we are either redirected and can enter password or if suspicious activity is detected (Login from different location/multiple bad password/username guesses) we are redirected to
input our username. This makes it more difficult to enumerate and brute force users since we need to know username+email to even be able to try passwords. However we still get 5-15 chances before lock-out to try usernames which
can be bruteforced with a bit of educated guess like using name from email or that name + some numbers etc. When wrong username is input page shows message `Incorrect, please try again.` and **400 Bad Request** is sent, user is
then redirected to the same page to try again on a correct username guess we are redirected to input password with **200 OK** response. Note that usernames can be seen by any logged in users - every twitter user has his username on his profile
and under every tweet as `@<username>` - and everyone can become user and therefore see usernames. So we can actually get all information needed to try to brutforce passwords if we are able to connect an account to it's email.
For example I used this method to get back access to a testing account I created and forgot the username of, because twitter appended some random numbers to it (as shown below). Another example is if we got the email used for registration of say Elon Musk (username @elonmusk) we could use this information to effectively lock him out of his twitter account or try to bruteforce his password. It is possible to enumerate user emails and potentially their usernames.  
<img src="assets/identity_management/enumeration_username.png" alt=" Username of account " width="50%" height="50%">

### 4.3.5 Testing for Weak or Unenforced Username Policy
When promted to set username, twitter by default fills the username field with first part of mail and if ambiguous apends some numbers. User can change his username to anything he pleases as long as it is unique across the application. 
So the usernames are implicitly structured but in reality can not be guessed with certainty as users can change them.  

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->
<!-- Style to center all images -->

## 4.4 Authentication Testing
### 4.4.1 Testing for Credentials Transported over an Encrypted Channel  
Twitter uses TLSv1.2 for data transfer encryption and HTTPS for all communication including login, user creation and password change, it can not be forced to 
use unsecure HTTP.  
<img src="assets/authentication/login_wireshark.png" alt=" Wireshark login "><br>
Communication capture of login via Wireshark.  

### 4.4.2 Testing for Default Credentials  
While testing different credentials in the register page I found out there are users with admin@twitter.com and guest@twitter.com registered.  
<img src="assets/authentication/mail_admin.png" alt=" Mail admin "><br>
<img src="assets/authentication/mail_guest.png" alt=" Mail guest "><br>
Twittter indeed uses @twitter.com address (for example registering verification mail is sent from verification@email.com) and they [state](https://help.twitter.com/en/safety-and-security/fake-twitter-emails)
it as official way of communication,  
<img src="assets/authentication/mail_address.png" alt=" Mail address "><br>
however there is no way of knowing if they are actual twitter.com default/admin credentials, they can however be used to lock out these accounts as described below.  

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

### 4.4.3 Testing for Weak Lock Out Mechanism  
Twitter's lock out mechanism activates after 5-15 (scales with repeating tries) unsuccessful entries of password/username. Any following tries result in the following message.  
<img src="assets/authentication/lock_out_message.png" alt=" Lock-out message " width="50%" height="50%"><br>
Unlock mechanism is time-based with time-out of 30+ minutes (Twitter [officially states](https://help.twitter.com/en/managing-your-account/locked-out-after-too-many-login-attempts)
it is an hour lock-out, my first lock-out was shorter though).
<img src="assets/authentication/lock_out_desribe.png" alt=" Lock-out Information "><br>
It also provides possibility to send a form with login issue, but none of the possibilities fit nor help with the lock out issue.  
<img src="assets/authentication/login_issue_form.png" alt=" Login issue form "><br>
If twitter suspects an unusual login activity (lot of bad tries/new location) it prompts the user to input their username or phone, this can also be used to lock-out an account,
as it uses same policy as password lock-out mechanism.  
<img src="assets/authentication/suspicious_activity_precaution.png" alt=" Suspicious activity " width="50%" height="50%"><br>

### 4.4.4 Testing for Bypassing Authentication Schema  
It is not possible to bypass authentication through direct page request. It is possible to visit someones profile with `twitter.com/<username>`, however this does not
disclose any personal/secret information as it shows someone's profile (what it shows depends on individual's account security settings).  
Session IDs look random, they have some similar parts but their value changes unpredictably each login even in concurrent sessions.  

### 4.4.5 Testing for Vulnerable Remember Password  
The login page does not offer 'remember password' functionality and it does not store user's credentials instead replacing them with secure tokens like sessionID.  
<img src="assets/authentication/login_form.png" alt=" Login form " width="50%" height="50%"></p>

### 4.4.6 Testing for Browser Cache Weaknesses  
Attacker can not access private information with the 'History' function and 'Back' button, he gets redirected to secure version of that page where he acts as a guest account or to login page to get authorized.  
The website uses HTTP directives to secure cache correctly with the following settings (copied from response headers).  
<img src="assets/authentication/cache_settings.png" alt=" Cache HTTP settings "><br>
Twitter stores a lot of information in cache, it does so securely and no information can be gathered from the cache. The cache can be viewed by using URL `about:cache` on Firefox.    
<img src="assets/authentication/cache_storage.png" alt=" Browser Cache "></p>

### 4.4.7 Testing for Weak Password Policy
Password policy allows any type of character found on standard keyboard. It requires at least 8 characters and accepts 128 most. It does not force numbers or special characters
but a short password without those will be marked as weak and not accepted. The passwords are checked against common passwords so passwords like `princess` or `password` or `iloveyou` 
will not be allowed, however adding a number to them will 'fix' this so passwords like `princess1` or `password1234` work. General password entropy is not calculated as passwords like `aaaaaaaab`
are also accepted. During registration user can choose password same as his chosen name but if he tries to change a password to his username later via the 'Change your password' function as logged user
password with his username will be rejected (part of it with numbers is okay though). Username is not rejected during registration before user picks his username after creating password. At least for consistency stake it would be best to choose username and then password so it can be checked like in change password functionality. It is not required to confirm password which made me accidentaly enter and submit password I was not yet intending to
use and therefore did not know it when trying to log in again forcing me to reset password.  

User is not forced to change his password after any period of time and he can change his password whenever he pleases with different methods. Change password function requires previous password knowledge. 
The changed passwords can be very similar to previous, it is not allowed to change to same password though. Also the warning messages are different from those seen during registration, if we use common 
password (princess/password) we are presented with *`That password is too easy to guess. Please choose a stronger password.`* while in registration the message was just *`Please enter a stronger password`*. 
Registration phase allows *`show password`* function while *`change password`* function does not.  

<img src="assets/authentication/passwd_example1.png" alt=" Password example 1 " width="50%" height="50%">
<img src="assets/authentication/passwd_example2.png" alt=" Password example 2 " width="50%" height="50%">
<img src="assets/authentication/passwd_example3.png" alt=" Password example 3 " width="50%" height="50%">
<img src="assets/authentication/passwd_example4.png" alt=" Password example 4 " width="50%" height="50%">
<img src="assets/authentication/passwd_example5.png" alt=" Password example 5 " width="50%" height="50%">
<img src="assets/authentication/passwd_example6.png" alt=" Password example 6 " width="50%" height="50%">  
<br>

As mentioned before twitter does not force pretty much any requirements for the password although they provide tips for password strenght in their [Help center](https://help.twitter.com/en/safety-and-security/account-security-tips)
<img src="assets/authentication/passwd_tips.png" alt=" Password Tips " width="50%" height="50%"></p>

### 4.4.8 Testing for Weak Security Question Answer  
Twitter does not use security question functionality.  

### 4.4.9 Testing for Weak Password Change or Reset Functionalities  
Logged in users can change their passwords with method described under [Testing for Weak Password Policy](#447-testing-for-weak-password-policy) using their current password.  
If user is not logged in he can reset his password via the *`Forgot password?`* functionality. If unusual activity is detected user is prompted to input their username (As described in above subsections), meaning password of
disclosed users (for example previously found admin@twitter.com) cannot be reset. Otherwise user is asked to select email to send verification code to (the code seems to be 8 lenght randomly generated digit-letter sequence).
After inputing the correct code user can change his password. The password policy to new password as well as warning messages are the same as when registrating with new password, this time however it is reqiuired to repeat the password.
When the password is reset user is prompted to enter reason for changing password and is logged out of all active Twitter sessions, as stated in Twitter's [Help Center](https://help.twitter.com/en/managing-your-account/forgotten-or-lost-password-reset).  
<img src="assets/authentication/passwd_reset.png" alt=" Password reset" width="50%" height="50%"></p>

### 4.4.10 Testing for Weaker Authentication in Alternative Channel  
No alternative channels are in our scope (mobile/desktop app).  

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.5 Authorization Testing
### 4.5.1 Testing Directory Traversal File Include
Twitter does not use GET arguments to load files, arguments are rather used to specify settings. Values in cookies are encoded and most likely are not used for dynamic page generation. Attack is therefore not possible.  
<img src="assets/authorization/get_request.png" alt=" GET request " height="50%" width="50%">  

### 4.5.2 Testing for Bypassing Authorization Schema
As we are again testing in black-box setting, we can only test with user privileges/role. For the same reason we can only test for horizontal bypassing.  
Twitter does not identify users by parameter but rather with combination of the right cookie + csrf token and header. So by changing the cookie of one users request with cookie from others gets the response 403 Forbidden and error message with code 353: `This request requires a matching csrf cookie and header.`  
By changing both csrf token and cookie we can get the response of other user but by that we authorized ourselves as that user so that is correct behaviour (getting this information would require to catch communication and decode cookie and csrf token). Horizontal bypassing is not possible.  

### 4.5.3 Testing for Privilege Escalation
Privileges on twitter website are most likely stored in the `auth_token` part of cookie as a hash. No other variables store or allow manipulation in HTTP communication.  
No file with missing or bad authorization checking were found by URL traversal.   

### 4.5.4 Testing for Insecure Direct Object References
Again twitter loads page contents via POST/GET graphQL requests (`POST /i/api/graphql/eB2SB0qYfesXNLf9joi-_w/HomeTimeline`) to api that return the needed content so there is no possible input for object/content manipulation.  

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.6 Session Management Testing

### 4.6.1 Testing for Session Management Schema

<!-- CSS for cookie schema-->
<style>
.cookie_schema_table {
  width: 100%;
  border: 2px solid;
  border-collapse: collapse;
}

tr:nth-child(even) {
  background-color: #f2f2f2;
}

th {
  border-bottom: 2px solid;
  text-align: center;
}

td {
  border: 1px solid;
  text-align: center;
}
</style>

<!-- Cookie Schema Table-->
<table class="cookie_schema_table">
    <tr>
        <th>Name</th>
        <th>Domain</th>
        <th>Expires in</th>
        <th>HttpOnly</th>
        <th>Secure</th>
        <th>SameSite</th>
        <th>Note</th>
    </tr>
    <tr>
        <td>_gid</td>
        <td>.twitter.com</td>
        <td>28 hours</td>
        <td>No</td>
        <td>No</td>
        <td></td>
        <td>Google Analytics</td>
    </tr>
    <tr>
        <td>IDE</td>
        <td>.doubleclick.net</td>
        <td>1 year</td>
        <td>Yes</td>
        <td>Yes</td>
        <td>None</td>
        <td>Doubleclick integration and/or analytics</td>
    </tr>
    <tr>
        <td>_ga_</td>
        <td>.twitter.com</td>
        <td>1 year</td>
        <td>No</td>
        <td>No</td>
        <td></td>
        <td>Google Analytics</td>
    </tr>
    <tr>
        <td>att</td>
        <td>.twitter.com</td>
        <td>1 day</td>
        <td>Yes</td>
        <td>Yes</td>
        <td>None</td>
        <td>Authentication and password reset</td>
    </tr>
    <tr>
        <td>guest_id</td>
        <td>.twitter.com</td>
        <td>1 year</td>
        <td>No</td>
        <td>Yes</td>
        <td>None</td>
        <td>Advertising when logged out</td>
    </tr>
    <tr>
        <td>twid</td>
        <td>.twitter.com</td>
        <td>1 year</td>
        <td>No</td>
        <td>Yes</td>
        <td>None</td>
        <td>Authentication</td>
    </tr>
    <tr>
        <td>auth_token</td>
        <td>.twitter.com</td>
        <td>1 year</td>
        <td>Yes</td>
        <td>Yes</td>
        <td>None</td>
        <td>Account login and authentication</td>
    </tr>
    <tr>
        <td>ct0</td>
        <td>.twitter.com</td>
        <td>1 year</td>
        <td>No</td>
        <td>Yes</td>
        <td>Lax</td>
        <td>Authentication</td>
    </tr>
    <tr>
        <td>lang</td>
        <td>twitter.com</td>
        <td>Session</td>
        <td>No</td>
        <td>No</td>
        <td></td>
        <td>Language functionality</td>
    </tr>
    <tr>
        <td>kdt</td>
        <td>.twitter.com</td>
        <td>1 year</td>
        <td>Yes</td>
        <td>Yes</td>
        <td></td>
        <td>Authentication of a known device</td>
    </tr>
    <tr>
        <td>d_prefs</td>
        <td>.twitter.com</td>
        <td>6 months</td>
        <td>No</td>
        <td>Yes</td>
        <td></td>
        <td>Cookie preferences</td>
    </tr>
    <tr>
        <td>_twitter_sess_</td>
        <td>.twitter.com</td>
        <td>Session</td>
        <td>Yes</td>
        <td>Yes</td>
        <td></td>
        <td>User session</td>
    </tr>
    <tr>
        <td>guest_id_marketing</td>
        <td>.twitter.com</td>
        <td>1 year</td>
        <td>No</td>
        <td>Yes</td>
        <td>None</td>
        <td>Advertising when logged out</td>
    </tr>
    <tr>
        <td>guest_id_ads</td>
        <td>.twitter.com</td>
        <td>1 year</td>
        <td>No</td>
        <td>Yes</td>
        <td>None</td>
        <td>Advertising when logged out</td>
    </tr>
    <tr>
        <td>personalization_id</td>
        <td>.twitter.com</td>
        <td>1 year</td>
        <td>No</td>
        <td>Yes</td>
        <td>None</td>
        <td>Tracking activities on and off Twitter for personalization</td>
    </tr>
</table>


### 4.6.2 Testing for Cookies Attributes

Attribute secure is used for all authentication related cookies. However few authentication cookies have the attribute SameSite set to None which may lead to cookie hijacking in case of CSRF/XSS vulnerability.


### 4.6.3 Testing for Session Fixation

The cookie _twitter_sess is set before the authentication and it remains the same after successful authentication. When that _twitter_sess value is set to another user it doesn't make them authenticated as the original one, probably because there are many cookies used in combination for the authentication. 


### 4.6.4 Testing for Exposed Session Variables

Session cookie has its own different value for every session. Protection from eavesdropping is ensured by HTTPS protocol.  

When the _twitter_sess cookie is set, it comes with cache-control directives (apart from others) `no-cache` and `no-store` which prevent it from being cached.  
<img src="assets/session_management_testing/session_cookie_cache_control.png" alt="session cookie cache control"><br>

After reviewing the client-server communication the session cookie seems to be contained only in POST requests.


### 4.6.5 Testing for Cross Site Request Forgery

CSRF Token is included in the _twitter_sess cookie and also as a HTTP header X-Csrf-Token in requests, which prevents the application from being vulnerable to Cross Site Request Forgery.


### 4.6.6 Testing for Logout Functionality

The logout button is placed in an area of the page that is fixed in the view port of the browser and isn't affected by scrolling of the content. However the logout button cannot be seen directly as user first has to click on the three dots next to his account name and then choose the logout button from the menu that pops out.  

<img src="assets/session_management_testing/account_options_logout_button.png" alt="account options logout button"><br>
<img src="assets/session_management_testing/logout_button.png" alt="logout button"><br>

Note that user cannot log out within the user interface before they answer the cookie related dialog.  

<img src="assets/session_management_testing/cookie_dialog_hidden_logout_button.png" alt=""><br>

If one is logged out and tries to load a page that is only available to authenticated users with their old session cookies, the application sends a response that something went wrong.  

<img src="assets/session_management_testing/invoke_logged_out_session.png" alt="invoke old session"><br>


### 4.6.7 Testing Session Timeout

During the testing process I haven't experienced a single timeout, therefore the only time limit appears to be the expiry date of cookies.


### 4.6.8 Testing for Session Puzzling

All session variables seem to be correctly regenerated for every session and no session puzzling was detected.


### 4.6.9 Testing for Session Hijacking

The application runs on HTTPS, uses HSTS and all cookies related to session or authentication are marked as secure.


<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.7 Input Validation Testing
### 4.7.1 Testing for Reflected Cross Site Scripting
None of the input vectors (POST/GET parameters) are reflected in response or generate an output that would suggest XSS vulnerability.  

### 4.7.2 Testing for Stored Cross Site Scripting
Here the input vector is obviously the "tweet" mechanism, where user can input anything and it is stored in the backend and can be displayed by any user. Another possible vector is comments below "tweets".  
After testing these vectors backend seems to validate and sanitize input very well and no issue was encountered on Twitter's part. Another problem is once again Twitter's obfuscation of its functionality.  

### 4.7.3 Testing for HTTP Verb Tampering
Discussed in [4.2.6 Test HTTP Methods](#426-test-http-methods).  

### 4.7.4 Testing for HTTP Parametr Pollution
Search function uses GET parameters. Using multiple same name parameters returns results for only the first one. 
<img src="assets/input_validation_testing/HPP_multiple_parameter.png" alt="Multiple variable search">  
No vulnerability found.  

### 4.7.5 Testing for SQL Injection
Input vector for SQL injection could again be the search function, that might communicate with database through API. Trying some classic SQL malicious code like different types of comments (since we don't know what database twitter is running on) did not yield any suspicious result. In fact testing right in the browser shows that any special symbol `@#$%^-'";:` on its own returns "Something went wrong".  
<img src="assets/input_validation_testing/SQL_specials.png" alt="SQL special characters reaction">   
The following screenshot shows that the function sanitizes the input correctly and no unintended behaviour was found.  
<img src="assets/input_validation_testing/SQL_escaping.png" alt="SQL escaping characters">   
Once again testing in black-box setting with little to none information about how the back-end, front-end and API communication is realised and what exactly each layer does proves to be the biggest obstacle in finding possible vulnerabilities.  

### 4.7.6 Testing for LDAP Injection
Twitter probably does not use LDAP, if so, it does so correctly. When applying search filters the request looks like this:  
<img src="assets/input_validation_testing/LDAP_filter.png" alt=" Filter of search function">   

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

### 4.7.7 Testing for XML Injection
Twitter does not use XML style communication.  

### 4.7.8 Testing for SSI Injection
We could not determine if SSI is enabled since we don't have access to web server and no `.shtml` pages were found.  

### 4.7.9 Testing for XPath Injection
Since Twitter does not use XML documents XPath injection is not possible as well.  

### 4.7.10 Testing for IMAP SMTP Injection

Twitter does not provide any public mail service.

When creating a user account, we received an email with verification code from verify@twitter.com. In that email's headers was stated that it was received from spring-chicken-cb.twitter.com [199.16.156.136], but running `nmap` on it didn't reveal any open ports.

<img src="assets/input_validation_testing/mail_headers.png" alt="email headers"><br>
<img src="assets/input_validation_testing/nmap_mail.png" alt="nmap mail"><br>


### 4.7.11 Testing for Code Injection

Command parameters were injected into various URLs, but none of them worked.

<img src="assets/input_validation_testing/inject_cmd_parameter_1.png" alt="command injection 1"><br>
<img src="assets/input_validation_testing/inject_cmd_parameter_2.png" alt="command injection 2"><br>
<img src="assets/input_validation_testing/inject_cmd_parameter_3.png" alt="command injection 3"><br>

 
#### 4.7.11.1 Testing for Local File Inclusion

No requests or scripts that take filename as a parameter were found.


#### 4.7.11.2 Testing for Remote File Inclusion

No requests or scripts that take filename as a parameter were found.


### 4.7.12 Testing for Command Injection

No place for command injection was found.


### 4.7.13 Testing for Format String Injection

We tried to insert formatting strings into many different places but none of them caused unexpected behaviour.


### 4.7.14 Testing for Incubated Vulnerability

We didn't find any vulnerability suitable for incubation.


### 4.7.15 Testing for HTTP Splitting Smuggling

We didn't find any data that were contained in the request and then would appear in the reponse header.


### 4.7.16 Testing for HTTP Incoming Requests

We don't have access to the server, hence we cannot setup a reverse proxy on the server side.  

When reviewing requests and responses on the client side, none of them seemed suspicious.


### 4.7.17 Testing for Host Header Injection

When supplied another domain into the Host header field, the server responds with 404 Not Found.  
<img src="assets/input_validation_testing/supply_another_domain_host_header_field.png" alt="supply another domain host header field"><br>

We didn't find any request that would contain the X-Forwarded-Host header. When we added the header ourselves, the server seemed to not process that header at all.  
<img src="assets/input_validation_testing/supply_another_domain_x-forwarded-host.png" alt="supply another domain x-forwarded-host"><br>

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

### 4.7.18 Testing for Server-side Template Injection

No Server-side Template Injection vulnerabilities were found.


### 4.7.19 Testing for Server-side Request Forgery

No Server-side Request Forgery injection points were found.


<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.8 Testing for Error Handling
### 4.8.1 Testing for Improper Error Handling
When testing for possible attack vectors we found out that the page responds correctly (with 404 (Not found) or 401 (Unauthorized)) when sending GET/POST requests
to random files or files higher in the hierarchy. Trying different requests (HEAD/DELETE...) returns 405 (Method not allowed). When trying a really long path we recieve `RST_STREAM error 0x2 (Implementation fault)` which doesn't seem to be
an issue on twitter's side but isn't really documented either.  
Another testing was performed by messing with POST and GET parameters. The following GET request parameter `supports_ntab_urt` returns different responses:  
`GET /i/api/2/badge_count/badge_count.json?supports_ntab_urt=1 HTTP/2`  
- 1 / true -> OK 200  
- 2 / abcd -> BAD REQUEST 400 (body of response: `{"errors":[{"code":358,"message":"Unable to parse supports_ntab_urt parameter."}]}`)  
- 0 / false -> Internal Server Error 500  (body of response: `{"errors":[{"message":"Internal error","code":131}]}`)  
Which looks well defined and other tests did not find any unsuspected/improper behaviour.    

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.9 Testing for Weak Cryptography

### 4.9.1 Testing for Weak Transport Layer Security

We ran `sslscan --show-sigs --verbose twitter.com`. You can see the full output in outputs/sslscan.txt.

The application only supports TLSv1.2 and TLSv1.3.

No ciphers that aren't considered secure nowadays are supported.

The SSL Certificate has signature ecdsa-with-SHA384 with key strength 128 bit, signed by DigiCert and is valid for 366 days.

<img src="assets/testing_for_weak_cryptography/sslscan_ssl_tls_protocols.png" alt="ssl tls protocols"><br>
<img src="assets/testing_for_weak_cryptography/sslscan_certificate.png" alt="certificate"><br>
<img src="assets/testing_for_weak_cryptography/sslscan_supported_ciphers.png" alt="supported ciphers"><br>


### 4.9.2 Testing for Padding Oracle

Session and authentication related cookies are encrypted but aren't multiples of 8/16 which implies that a stream cipher was used, and therefore it doesn't meet the requirements for possibility of the Padding Oracle vulnerability.


### 4.9.3 Testing for Sensitive Information Sent via Unencrypted Channels

All data is sent via HTTPS.


### 4.9.4 Testing for Weak Encryption

`sslscan` didn't find any weak encryption on the transport layer.

As we don't have access to the back-end source code we cannot determine which algorithms are used for the encryption that happens on the server side (password hashes, authentication cookies etc.).


<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.10 Business Logic Testing

### 4.10.1 Test Business Logic Data Validation

As for the GUI, the only input where validation is needed is the create account form. Other inputs such as tweet, searched value etc. may be pretty much anything. GUI checks the email meaning if it has form of an email address ({name}@{domain}). It doesn't check if the email actually exists, however the next step of account creation is entering the verification code which is sent to the email entered before. That implies that we cannot use neither non-existing email nor an email address that we don't have access to.  
Date of birth is checked as well, account creation fails when date from future entered.

<img src="assets/business_logic_testing/create_account_invalid_email.png" alt="invalid email adress" width=49%>
<img src="assets/business_logic_testing/create_account_non_existing_email.png" alt="non-existing email" width=49%><br>

<img src="assets/business_logic_testing/create_account_date_from_future.png" alt="date from future" width=69%>
<img src="assets/business_logic_testing/create_account_date_from_future_failed.png" alt="date from future failed" width=30%><br>

When performing single HTTP requests as such, containing invalid data, we received responses more or less describing why the request was invalid. Except when the JSON object contained two email elements, in that case the server responded with 500 Internal Server Error, meaning this edge case is not correctly handled (likely by the JSON parser).

<img src="assets/business_logic_testing/request_create_account_blank_email.png" alt="blank email">
<img src="assets/business_logic_testing/request_create_account_invalid_email.png" alt="invalid email">
<img src="assets/business_logic_testing/request_create_account_verification_different_json_parameter.png" alt="different json parameter">
<img src="assets/business_logic_testing/request_create_account_verification_invalid_email.png" alt="invalid email">
<img src="assets/business_logic_testing/request_create_account_verification_no_email.png" alt="no email">
<img src="assets/business_logic_testing/request_create_account_verification_two_emails.png" alt="two emails">


### 4.10.2 Test Ability to Forge Requests

When reviewing the common HTTP traffic, no guessable values nor hidden features were found. Data consist of user entered content and apparently randomly generated tokens and ids.


### 4.10.3 Test Integrity Checks

We didn't find neither hidden fields nor places to insert information into areas that are non-editable.


### 4.10.4 Test for Process Timing

Entering both correct and incorrect usernames and passwords took the same time to process. We didn't find any other scenario in which process timing could be taken advantage of.

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

### 4.10.5 Test Number of Times a Function Can Be Used Limits

The application has several technical limits as follows:
<!-- CSS for limits table-->
<style>
.limits_table {
  width: 100%;
  border: 2px solid;
  border-collapse: collapse;
}

tr:nth-child(even) {
  background-color: #f2f2f2;
}

th {
  border-bottom: 2px solid;
  text-align: center;
}

td {
  border: 1px solid;
  text-align: center;
}
</style>
<!-- Limits table-->
<table class="limits_table">
    <tr>
        <th>Functionality</th>
        <th>Limit</th>
    </tr>
    <tr>
        <td>Direct Messages</td>
        <td>500 messages sent per day</td>
    </tr>
    <tr>
        <td>Tweets</td>
        <td>2400 per day</td>
    </tr>
    <tr>
        <td>Changes to account email</td>
        <td>4 per hour</td>
    </tr>
    <tr>
        <td>Following (daily)</td>
        <td>400 per day</td>
    </tr>
    <tr>
        <td>Following (account-based)</td>
        <td>5000 per account</td>
    </tr>
</table>

We haven't been able to test any of them because the limits are too high to perform manually, sending repeated requests through BurpSuite or curl didn't work and API for those tasks is a paid functionality. In case of Changes to account email it would be possible to perform manual test except the fact that probably due to our penetration testing Twitter wouldn't allow us to do so, even when we created a fresh account with no suspicious history.

<img src="assets/business_logic_testing/change_email_failed.png" alt="change email failed" width=50%><br>


### 4.10.6 Testing for the Circumvention of Work Flows

The only multistep activity is the account creation, which cannot be bypassed due to email verification as one of the steps. No other multistep activity was found.

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

### 4.10.7 Test Defenses Against Application Misuse

During the testing process we have found several defense mechanisms against application misuse:

- account lock out mechanism when repeatedly entered incorrect credentials
- impossibility of repeatedly posting tweets using the same HTTP request
- impossibility of repeatedly sending direct messages using the same HTTP request
- restrictions for account settings when suspicious activity is spotted
- front-end source code is well obfuscated with no comments in place and torn into pieces which makes it nearly impossible to understand


### 4.10.8 Test Upload of Unexpected File Types

The application supports uploading media when posting a tweet. Officially accepted file formats are GIF, JPEG and PNG.

GUI doesn't allow to upload any file format but these three. Even when an unsupported file is given a supported suffix, the page reports that upload failed.

When intercepting the request for upload the media and changing both file type and file data, the application reports that upload failed.

<img src="assets/business_logic_testing/media_failed_to_upload.png" alt="media upload failed" width=50%><br>

When media is uploaded successfuly, the aplication doesn't disclose the path but only reports the media id.

<img src="assets/business_logic_testing/media_uploaded.png" alt="media uploaded"><br>


### 4.10.9 Test Upload of Malicious Files

As we weren't able to upload any unexpected file types, that leaves us with uploading a malicious image, but since the malicious code inserted into an image would be run by the browser, not the application, it is beyond the scope of this pentest.


<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.11 Client-side Testing
### 4.11.1 Testing for DOM-Based Cross Site Scripting
Manual testing and searching for possible sources of DOM CSS did not yield any results. Testing with Burp Suite's DOM Invader gave a few sinks but these have proven to be false-positives. Application does not seem vulnerable to DOM-based CSS.  

<img src="assets/client-side/CSS_sinks.png" alt=" False positive sinks ">  

Twitter uses graphQL and its API to load dynamic page contents and store user tweets. All validation therefore happens in the backend, which we have no access to, so it is very difficult to guess what is happening there. However all tests indicate that the all the input validation/sanitization is well performed and no errors or suspicious artefacts were found.  

### 4.11.2 Testing for JavaScript Execution
Similar to the previous paragraph, we did not find any possible attack vector.  

### 4.11.3 Testing for HTML Injection
Again no possible input for HTML Injection found.  

### 4.11.4 Testing for Client-side URL Redirect
URL redirect again happens through backend API and does not leave room for tampering.  
When user clicks a link in a tweet from a different user he is redirected with the following GET request and response.  
<img src="assets/client-side/URL_redirect.png" alt=" Redirect exchange ">  
We can see that the request goes to the `t.co` webpage, which is twitter's own link shortener that, they [claim](https://developer.twitter.com/en/docs/tco), also protects users from various malicious activity.  
<img src="assets/client-side/URL_t.co.png" alt=" t.co webpage ">  

### 4.11.5 Testing for CSS Injection
No CSS injection point found on the website.  

### 4.11.6 Testing for Client-side Resource Manipulation
No vulnerability was found.  

### 4.11.7 Testing Cross Origin Resource Sharing
Twitter uses `Access-Control-Allow-Origin` header safely only allowing `https://twitter.com` (no wildcard used). Other `Access-Control` headers are also used in a reasonable way.  
<img src="assets/client-side/access_control.png" alt=" Access control headers ">   

### 4.11.8 Testing for Cross Site Flashing
Attack not possible.  

### 4.11.9 Testing for Clickjacking
Basic clickjacking attempt yields no result as the page does not show in our frame.  
<img src="assets/client-side/basic_clickjack.png" alt=" Basic Clickjacking attack ">   

Advanced clickjacking attempts like double framing or using sandbox and security attributes are also unsuccessful.   
Twitter uses header `X-Frame-Options: SAMEORIGIN` that ensures that page's contents can not be loaded into frames, iframes etc. that are from different origin than the page itself, effectively preventing Clickjacking attacks.  

### 4.11.10 Testing WebSockets
No WebSockets signs were found in the client-side source code or communication.  

### 4.11.11 Testing Web Messaging
Twitter does not use Web Messaging (Cross Document Messaging).  

### 4.11.12 Testing Browser Storage
Twitter does not store any persistent values in `window.localStorage`, the only value output when trying to list the storage is `volume: 1` (note that the value changes based on browser used).  
Listing `sessionStorage` which is non-persistent and resets after window closes yields some results but does not store any sensitive data.  
<img src="assets/client-side/session_storage.png" alt=" Session storage contents ">   
Listing IndexedDB does not show any issues.  
Cookies do not store any sensitive data neither.  
Nothing of interest found stored as global window object.    

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

### 4.11.13 Testing for Cross Site Script Inclusion
No global variables/function parameters or CSV values containging sensitive data were found.  
There are no JS warnings or errors in the browser console.  

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->


# Sources

- https://blog.twitter.com/engineering/en_us/topics/infrastructure/2017/the-infrastructure-behind-twitter-scale

- https://www.first.org/cvss

- https://blog.twitter.com/engineering/en_us/topics/

- http://www.pentest-standard.org

- https://www.thirdrocktechkno.com/blog/react-security-vulnerabilities/

- https://help.twitter.com/en/rules-and-policies/twitter-limits

- https://help.twitter.com/en/rules-and-policies/twitter-cookies
