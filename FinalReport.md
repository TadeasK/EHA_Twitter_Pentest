<h1 style="text-align: center; font-size: 350%"> Twitter Penetration Test Report</h1>   
<h2 style="text-align: center">BI-EHA Semestral work</h2>


---

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br>

<h3 style="text-align: center;">Jan Koníř, Tadeáš Kouba</h3>
<h3 style="text-align: center;">FIT CTU, 2023</h3>

<!-- Page break -->
<div style="page-break-after: always;"></div>

<!-- ======================================================================================================================================================== -->

# Table of Contents

- [Table of Contents](#table-of-contents)
- [Introduction](#introduction)
  - [Team Info](#team-info)
  - [Project Overview](#project-overview)
  - [Scope Description](#scope-description)
  - [Pentesting Methodology](#pentesting-methodology)
  - [Scoring System](#scoring-system)
- [Executive Summary](#executive-summary)
- [List of Findings](#list-of-findings)
- [Pre-engagement](#pre-engagement)
  - [Threat Model](#threat-model)
  - [Intelligence-gathering Outcomes](#intelligence-gathering-outcomes)
- [Testing process](#testing-process)
  - [4.1 Information Gathering](#41-information-gathering)
  - [4.2 Configuration and Deployment Management Testing](#42-configuration-and-deployment-management-testing)
  - [4.3 Identity Management Testing](#43-identity-management-testing)
    - [4.3.1 Test Role Definitions](#431-test-role-definitions)
    - [4.3.2 Test User Registration Process](#432-test-user-registration-process)
    - [4.3.4 Testing for Account Enumeration and Guessable User Account](#434-testing-for-account-enumeration-and-guessable-user-account)
    - [4.3.5 Testing for Weak or Unenforced Username Policy](#435-testing-for-weak-or-unenforced-username-policy)
  - [4.4 Authentication Testing](#44-authentication-testing)
  - [4.5 Authorization Testing](#45-authorization-testing)
  - [4.6 Session Management Testing](#46-session-management-testing)
  - [4.7 Input Validation Testing](#47-input-validation-testing)
  - [4.8 Testing for Error Handling](#48-testing-for-error-handling)
  - [4.9 Testing for Weak Cryptography](#49-testing-for-weak-cryptography)
  - [4.10 Business Logic Testing](#410-business-logic-testing)
  - [4.11 Client-side Testing](#411-client-side-testing)
- [Sources](#sources)


<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Introduction
## Team Info

- Jan Koníř
  - konirjan@fit.cvut.cz
  - Student of CTU, Faculty of Information Technology

<br>

- Tadeáš Kouba
  - koubatad@fit.cvut.cz
  - Student of CTU, Faculty of Information Technology

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Project Overview
This report is part of semestral work for subject Ethical hacking of the Information Security program on FIT, CTU.  
The focus is to assert skills gained during the semester as well as use them in real-world scenario. The website [twitter.com](https://twitter.com/) has been chosen for this purpouse as it offers a [bug bounty](https://hackerone.com/twitter?type=team) and is therefore eligible for ethical hackers to try and hack.  

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Scope Description
We will be focusing on the web application on domain twitter.com.  
While the bug bounty posted by twitter puts some vulnerabilities out scope for financial reward, we will still be trying to perform these attacks as to deepen our ethical hacking skills.

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Pentesting Methodology
<!-- https://owasp.org/www-project-web-security-testing-guide/stable/ -->
As a pentesting methodology we have chosen the [OWASP Web Application Security Testing](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/) guide - version 4.2, which is the latest stable version. To be more precise, we will be covering following topics:
  - Configuration and Deployment Management Testing
  - Identity Management Testing
  - Authentication Testing
  - Authorization Testing
  - Session Management Testing
  - Input Validation Testing
  - Testing for Error Handling
  - Testing for Weak Cryptography
  - Business Logic Testing
  - Client-side Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## Scoring System
We will be using the widely used [Common Vulnerability Scoring System (CVSS)](https://www.first.org/cvss/specification-document) standard for evaulating the threat levels of vulnerabilities found in this report. In particular we will use the CVSS 3.1 version. The standard defines multiple metrics (base, temporal, environmental), however we will use only the base metric since we are performing a one-time pentesting as external entity so the temporal and environmental metrics are not that important and available to us.  
We will be scoring each vulnerability on several factors such as access complexity, confidentiality impact, integrity impact and others, to calculate the final score. This will determine the final rating of that vulnerability as seen in the following table.  

<!-- CSS for scoring table-->
<style>
.scoring_table {
  width: 100%;
  border: 2px solid;
  border-collapse: collapse;
}

tr:nth-child(even) {
  background-color: #f2f2f2;
}

th {
  border-bottom: 2px solid;
  text-align: center;
}

td {
  border: 1px solid;
  text-align: center;
}
</style>

<!-- Scoring Table -->
<table class="scoring_table">
  <tr>
    <th>Rating</th>
    <th>CVSS Score</th>
  </tr>
  <tr>
    <td>Low</td>
    <td>0.1 - 3.9</td>
  </tr>
  <tr>
    <td>Medium</td>
    <td>4.0 - 6.9</td>
  </tr>
  <tr>
    <td>High</td>
    <td>7.0 - 8.9</td>
  </tr>
  <tr>
    <td>Critical</td>
    <td>9.0 - 10.0</td>
  </tr>
</table>

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Executive Summary
TBD

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# List of Findings
TBD

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Pre-engagement
## Threat Model
Twitter does not openly disclose how its backend communication works.  
Since twitter is a web application it is obviously exposed to the internet which naturally puts it in proximity of multitude of threats. On top of that it is definitely an attractive target for hackers, since it stores personal information of about 350 million people.  
Some vulnerable points might be the client-server-database communication for authentication or tweets being stored in database and showing to completely random users' feeds.

<!-- Page break -->
<!-- <div style="page-break-after: always;"></div> -->
<!-- ======================================================================================================================================================== -->

## Intelligence-gathering Outcomes
Firstly we ran port scan with **nmap**. We used the following command to find the open ports and possibly the version of service running on them:  
```nmap -sV twitter.com```  
![nmap -sV output](assets/preengagement/nmap_version.png)  

Full output can be seen in *outputs/nmap_version.txt*.     
We can see that there are two open tcp ports (80, 443).

We then ran **nmap** with intention to determine the OS running, version and traceroute with:  
```nmap -A twitter.com```  
![nmap -A output 1](assets/preengagement/nmap_output2.png)  

![nmap -A output 2](assets/preengagement/nmap_output1.png)  
Full output can be seen in *outputs/nmap_A.txt*.   
Here it is specified that on port 80 there is http running. Also all requests sent are returned with HTTP 400 so service as well as OS could not be recognized.

Then we ran **dnsenum** to try and gather some infromation about the domain:  
```dnsenum --enum twitter.com```  
![ dnsenum output ](assets/preengagement/dnsenum_output.png)  
Full output can be seen in *outputs/dnsenum.txt*.     
Which listed us a lot of subdomains and IP addresses of twitter.


As stated before the twitter developers don't share much information about twitter.
However through developer [blog](https://blog.twitter.com/engineering/en_us/topics/) they sometimes discuss what actually happens on twitter's backend. Through that we were able to find out that twitter used to run on MySQL database, but has switched to distributed database NoSQL system called Manhattan, that is custom developed for twitter. Manhattan itself utilizes multiple open-source technologies like Apache Cassandra or Hadoop. This information might prove useful for performing some SQL Injection attacks. 

As for the front-end part of Twitter it mostly consists of HTML, CSS and Javascript, particularly React.js. Of those, React.js is obviously the one to be concentrated on when pentesting. Some of its most common vulnerabilities are Cross-site scripting, SQL injection, Cross-site request forgery, Vulnerability in packages and dependencies, Broken authentication, Zip slip or XML external entities.

Last but not least we tried so called Google Hacking/Dorking but it didn't disclose any important information.

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

# Testing process

## 4.1 Information Gathering

This topic is covered in the [Pre-engagement section](#pre-engagement).

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.2 Configuration and Deployment Management Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.3 Identity Management Testing
### 4.3.1 Test Role Definitions
Since application is being tested as a black-box from a normal user standpoint we don't have information about available roles. Even after looking throught HTTP communication any specific roles
could not be identified. Therefore we are not able to test roles layout or permissions.  

### 4.3.2 Test User Registration Process
User can register using several different options (with Google/Apple account or native) we will test native registration process as the other two are using different applications and are out of scope.  
<img src="assets/identity_management/register_options.png" alt="Regsitration options" width="50%" height="50%">  

The requirments for registration are name, email and date of birth of user. Out of these options only email can be verified. Name can be anything and does not need to be unique, date of birth can be set to anything as it is not verified either.  
<img src="assets/identity_management/register_user_info.png" alt= "User data" width="50%" height="50%">  

In next step user is asked for different permissions which may be granted but are not required.  
<img src="assets/identity_management/register_permissions.png" alt=" Registration permissions " width="50%" height="50%">

In next step user information is confirmed (Notice that date of birth really does not matter as in the example the user's age is 5 years and email is checked in prior stages).  
<img src="assets/identity_management/register_confirmation.png" alt=" Confirm Registration " width="50%" height="50%">  

Next user is prompted to input the code sent to him via email (6 digits). Last step is the creation of password which is described in detail in [authentication testing](#44-authentication-testing)  
In summary anyone with access to an email can create twitter account. Registrations are granted automatically after confirmig email validity. As long as one has access to a valid email
he can register as many times as he can (for purposes of testing we created 5+ accounts with throwaway emails). Users can only register with basic user permissions and the only proof of
identity is email verification.  

### 4.3.4 Testing for Account Enumeration and Guessable User Account
It is quite easy to enumerate emails of accounts either when registrating (already used emails inform the user that email is used) or when trying to log in - when using valid email user is redirected to
input his password and when invalid email (not used in registration of any account yet) the following message is shown: *`Sorry, we could not find your account.`* also a HTTP response **400 Bad Request** is sent. 
When we have a valid email we are either redirected and can enter password or if suspicious activity is detected (Login from different location/multiple bad password/username guesses) we are redirected to
input our username. This makes it more difficult to enumerate and brute force users since we need to know username+email to even be able to try passwords. However we still get 5-15 chances before lock-out to try usernames which
can be bruteforced with a bit of educated guess like using name from email or that name + some numbers etc. When wrong username is input page shows message `Incorrect, please try again.` and **400 Bad Request** is sent, user is
then redirected to the same page to try again on a correct username guess we are redirected to input password with **200 OK** response. Note that usernames can be seen by any logged in users - every twitter user has his username on his profile
and under every tweet as `@<username>` - and everyone can become user and therefore see usernames. So we can actually get all information needed to try to brutforce passwords if we are able to connect an account to it's email.
For example I used this method to get back access to a testing account I created and forgot the username of, because twitter appended some random numbers to it (as shown below). Another example is if we got the email used for registration of say Elon Musk (username @elonmusk) we could use this information to effectively lock him out of his twitter account or try to bruteforce his password. It is possible to enumerate user emails and potentially their usernames.  
<img src="assets/identity_management/enumeration_username.png" alt=" Username of account " width="50%" height="50%">

### 4.3.5 Testing for Weak or Unenforced Username Policy
When promted to set username, twitter by default fills the username field with first part of mail and if ambiguous apends some numbers. User can change his username to anything he pleases as long as it is unique across the application. 
So the usernames are implicitly structured but in reality can not be guessed with certainty as users can change them.  

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.4 Authentication Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.5 Authorization Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.6 Session Management Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.7 Input Validation Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.8 Testing for Error Handling

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.9 Testing for Weak Cryptography

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.10 Business Logic Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->

## 4.11 Client-side Testing

<!-- Page break -->
<div style="page-break-after: always;"></div>
<!-- ======================================================================================================================================================== -->


# Sources

- https://blog.twitter.com/engineering/en_us/topics/infrastructure/2017/the-infrastructure-behind-twitter-scale

- https://www.first.org/cvss

- https://blog.twitter.com/engineering/en_us/topics/

- http://www.pentest-standard.org

- https://www.thirdrocktechkno.com/blog/react-security-vulnerabilities/
